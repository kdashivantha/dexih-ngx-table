<div class="no-padding">
    <div *ngIf="heading" class="dexih-table-heading">
        <h3>{{heading}}</h3>
    </div>

    <div class="dexih-table-error" *ngIf="error">
        <div class="alert alert-danger">
            {{error}}
        </div>
    </div>

    <div *ngIf="enableToolbar" class="dexih-table-toolbar">
        <div class="row">
            <div class="col">
                <div class="form-inline">
                    <button *ngIf="enableSaveCsv && tableItems" (click)="saveCsv()" class="btn btn btn-primary m-1" title="Export the current data to a csv file.">
                        <i class="fa fa-floppy-o"></i>&nbsp;
                        <span class="hidden-sm hidden-xs">Export</span>
                    </button>

                    <ng-template *ngIf="enableActions" [ngTemplateOutlet]="actionsTemplate" [ngTemplateOutletContext]="{items: currentSelectedItems}"
                        [ngTemplateOutletContext]="items">
                    </ng-template>
                    &nbsp;
                    <ng-template *ngIf="enableSingleSelectActions && selectedItemsCount == 1" [ngTemplateOutlet]="selectedItemActionsTemplate"
                        [ngTemplateOutletContext]="{item: currentSelectedItems[0]}" [ngTemplateOutletContext]="item">
                    </ng-template>
                    &nbsp;
                    <ng-template *ngIf="enableMultiSelectActions && selectedItemsCount > 0" [ngTemplateOutlet]="selectedItemsActionsTemplate"
                        [ngTemplateOutletContext]="{items: currentSelectedItems}" [ngTemplateOutletContext]="items">
                    </ng-template>
                </div>
            </div>
            <div *ngIf="enableFilter && tableItems?.length > 0" class="align-self-end mr-3 ml-3">
                <div [ngClass]="{disabled : manualSort}" class="input-group" style="width: 300px">
                    <span class="input-group-addon input-group-prepend">
                        <span class="input-group-text">
                            <i class="fa fa-search"></i>
                        </span>
                    </span>
                    <input [ngModel]="filterString" [formControl]="filterControl" class="form-control input-md" placeholder="Search..." type="search"
                        name="filterString" />
                </div>
            </div>
        </div>
    </div>

    <div *ngIf="tableItems" [ngClass]="{'table-responsive': enableResponsive}">
        <table name="dexih-table" [class]="tableClass" width="100%" dnd-sortable-container [sortableData]="tableItems">
            <thead>
                <tr *ngIf="currentColumns && enableHeaderRow">
                    <th *ngIf="enableMultiSelect" width="1%">
                        <input type="checkbox" [(ngModel)]="selectAllState" (ngModelChange)="selectAll()">
                    </th>
                    <th class="text-center" *ngIf="enableManualSort" width="1%">
                        <i class="fa fa-sort"></i>
                    </th>
                    <th class="text-center" *ngIf="enableRowActions">Action</th>
                    <th class="text-center" *ngIf="enableRowStatus">Status</th>
                    <th class="text-center" *ngFor="let column of currentColumns">
                        <span name="dexih-column-heading" class="d-flex d-flex-row" (click)="enableSort && ( column.name || column.name == 0 ) && sort(column.name)">
                                {{column.title}}
                                <i *ngIf="(sortColumn || sortColumn == 0) && sortColumn == column.name && sortDirection==1" class="fa fa-sort-amount-asc pull-right"></i>
                            <i *ngIf="(sortColumn || sortColumn == 0) && sortColumn == column.name && sortDirection==-1" class="fa fa-sort-amount-desc pull-right"></i>
                        </span>
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr *ngIf="tableItems.length == 0 || !currentColumns" dnd-droppable [dropZones]="dropZones" (onDropSuccess)="onDropSuccess($event)">
                    <td [attr.colspan]="columnCount">There are no rows available.</td>
                </tr>
                <ng-template ngFor let-tableItem [ngForOf]="tableItems" let-i="index">
                    <tr name="dexih-table-row" *ngIf="!tableItem.isFiltered" [class.active]="tableItem?.isSelected" dnd-droppable [dropZones]="dropZones" (onDropSuccess)="onDropSuccess($event)">
                        <td *ngIf="enableMultiSelect">
                            <input type="checkbox" [(ngModel)]="tableItem.isSelected" (ngModelChange)="itemSelected(true)">
                        </td>
                        <td *ngIf="enableManualSort">
                            <button class="btn btn-sm btn-primary" dnd-sortable [sortableIndex]="i" (onDropSuccess)="manualSortChange()" title="Drag button to move row to another position">
                                #
                            </button>
                        </td>
                        <td *ngIf="enableRowActions">
                            <ng-template [ngTemplateOutlet]="rowActionTemplate" [ngTemplateOutletContext]="{item: data[tableItem.index]}" [ngTemplateOutletContext]="item">
                            </ng-template>
                        </td>
                        <td *ngIf="enableRowStatus">
                            <ng-template [ngTemplateOutlet]="rowStatusTemplate" [ngTemplateOutletContext]="{item: data[tableItem.index]}" [ngTemplateOutletContext]="item">
                            </ng-template>
                        </td>
                        <td name="dexih-table-cell" *ngFor="let column of currentColumns" [ngStyle]="{'text-align': column.align, 'width': column.width, 'background-color': column.backgroundColor, 'text-color': column.textColor}"
                            (click)="selectRowClick(data[tableItem.index])" [title]="data[tableItem.index][column.tooltip] ? data[tableItem.index][column.tooltip] : ''">

                            <ng-template *ngIf="enableCellTemplate" [ngTemplateOutlet]="cellTemplate" [ngTemplateOutletContext]="{item: data[tableItem.index], column: column, value: data[tableItem.index][column.name]}"
                                [ngTemplateOutletContext]="item" [ngTemplateOutletContext]="column" [ngTemplateOutletContext]="value">
                            </ng-template>

                            <dexih-table-cell *ngIf="enableCellValue" [column]="column" [row]="data[tableItem.index]"></dexih-table-cell>
                        </td>
                    </tr>
                </ng-template>
            </tbody>
        </table>
    </div>

    <div *ngIf="!tableItems && !error">
        <div class="row">
            <div class="col-lg-9 col-md-7 col-sm-12 col-xs-12">
                <h3>&nbsp;&nbsp;&nbsp;
                    <i class="fa fa-spin fa-spinner"></i>
                    <span name="dexih-data-loading">Data is loading...</span>
                </h3>
            </div>
        </div>
    </div>
</div>